{"hash":"0a771fb00181f53c893dda3d5a078264d0ff86a7","data":{"doc":{"title":"Links","inner_title":"","description":"","content":"\n# Links\n\nAfter all the pins are defined and configured, you should also specify the links between them. \nIt can be done by uploading a special CR called the th2 link. \nBased on the components that the links connect, they can be separated into several files (e.g. `from-codec-links.yaml`, `from-act-links.yaml`, `dictionary-links.yaml`). \nThe most important is the location of the `.yaml` files in the links directory. \nAlso, all links can be configured in one file, but links for the dictionary should be in the `dictionaries-relation` section, and all other links in the `boxes-relation` section.\n\nLinks from the `boxes-relation` section connect boxes (Kubernetes pods) using pins, whereas, the  `dictionaries-relation` links allow boxes to use dictionary files (that are not related to the Kubernetes pods). \n\n## Dictionary links\n\nExample of `dictionary-links`: \n```yaml\napiVersion: th2.exactpro.com/v1\nkind: Th2Link\nmetadata:\n  name: dictionary-links\nspec:\n  dictionaries-relation:\n    - name: codec-fix-dictionary\n      box: codec-fix\n      dictionary:\n        name: fix50-generic\n        type: MAIN\n```\n\n## Boxes links\n\nEach link has the following attributes:\n\n- `name` - the name of the link;\n\n- `from` - the pin of the box from which this link goes;\n\n- `to` - the pin of the box to which it leads.\n\nThere are two ways of communication between the components via links:\n\n- RabbitMQ - message broker for asynchronous messaging;\n\n- gRPC - for specifying routing calls.\n\nFor each of the connection type there is a separate option in configuration:\n\n- `router-mq`\n\n- `router-grpc`  \n\nExample of `boxes-links`: \n\n```yaml\napiVersion: th2.exactpro.com/v1\nkind: Th2Link\nmetadata:\n  name: set-of-links\nspec:\n  boxes-relation:\n    router-mq:\n      - name: mq_relation_link\n        from:\n          box: source_box_name\n          pin: publish_pin_name\n        to:\n          box: destination_box_name\n          pin: subscribe_pin_name\n    router-grpc:\n      - name: grpc_relation_link\n        from:\n          box: source_box_name\n          pin: source_pin_name\n        to:\n          box: destination_box_name\n          pin: destination_pin_name\n```\n### MQ Router\n\nMQ links are described in the `router-mq` section of the link `.yaml` file. When using MQ links, you should keep in mind that the pins that are marked with the `publish` attribute must be specified in the `from` section, and those marked with `subscribe` (or not marked with either) must be specified in the `to` section. The message flow between the pins should be from `publish` to `subscribe`. \n\n```yaml\napiVersion: th2.exactpro.com/v1\nkind: Th2Link\nmetadata:\n  name: from-conn-links\nspec:\n  boxes-relation:\n    router-mq:\n      - name: democonn1-codec\n        from:\n          box: demo-conn1\n          pin: in_raw\n        to:\n          box: codec-fix\n          pin: in_codec_decode\n```\n\n### gRPC Router\n\ngRPC links are described in the section `router-grpc`.\n\n<notice note> Starting from v.1.7 of th2-infra-schema, this section no longer contains the `strategy` and `service-class` fields. \nFor newer releases, the properties are to be specified in configurations of pins ([more details](./pins#service-classes-setting-for-grpc-connection-type)). </notice>\n\n\nAn example of a gRPC link:\n\n```yaml\napiVersion: th2.exactpro.com/v1\nkind: Th2Link\nmetadata:\n  name: from-act-links\nspec:\n  boxes-relation:\n    router-grpc:\n      - name: act-to-check1\n        from:\n          box: act-fix\n          pin: to_check1\n        to:\n          box: check1\n          pin: server\n```\n## Example\n\nHere you can see shortened example of [links.yaml](https://github.com/th2-net/th2-infra-schema-demo/blob/ver-1.5.4-main_scenario/links/links.yml) file with different sections:\n```yaml\napiVersion: th2.exactpro.com/v1\nkind: Th2Link\nmetadata:\n  name: links\nspec:\n##############################################################################\n###                           DICTIONARIES                                 ###\n##############################################################################\n  dictionaries-relation:\n    - name: codec-fix-dictionary\n      box: codec-fix\n      dictionary:\n        name: fix50-generic\n        type: MAIN\n##############################################################################\n    - name: codec-fix-demo-dictionary\n      box: codec-fix-demo\n      dictionary:\n        name: fix50-generic\n        type: MAIN\n\n##############################################################################\n###                           BOXES MQ                                     ###\n##############################################################################\n  boxes-relation:\n    router-mq:\n#########################ACT-FIX -> CODEC-FIX#################################\n      - name: from-act-to-codec\n        from:\n          box: act-fix\n          pin: to_send\n        to:\n          box: codec-fix\n          pin: in_codec_encode\n##############################################################################\n#####################ACT-UI-BACKEND -> CODEC-FIX##############################\n      - name: act-to-fix-codec\n        from:\n          box: act-ui-backend\n          pin: to-fix-codec\n        to:\n          box: codec-fix\n          pin: in_codec_encode\n\n##############################################################################\n###                         BOXES GRPC                                     ###\n##############################################################################\n    router-grpc:\n#####################ACT-FIX -> CHECK1########################################\n      - name: act-to-check1\n        from:\n          box: act-fix\n          pin: to_check1\n        to:\n          box: check1\n          pin: server\n##############################################################################\n#####################RECON -> UTIL############################################\n      - name: recon-to-util\n        from:\n          box: recon\n          pin: to_util\n        to:\n          box: util\n          pin: server\n```\nBelow is the illustration of links between boxes given in the configuration file above.\n![](./links_schema.png) \n","fileInfo":{"path":"versions/1-7/infrastructure/th2-infra-schema/links.md"},"headings":[{"anchor":"#links","value":"Links","depth":1},{"anchor":"#dictionary-links","value":"Dictionary links","depth":2},{"anchor":"#boxes-links","value":"Boxes links","depth":2},{"anchor":"#mq-router","value":"MQ Router","depth":3},{"anchor":"#grpc-router","value":"gRPC Router","depth":3},{"anchor":"#example","value":"Example","depth":2}],"read_before":[],"continue_learning":[],"terms":[],"related":[],"hide_releases":null,"_githubRepository":null}},"context":{}}