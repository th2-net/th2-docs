(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"/HrQ":function(t,a){t.exports={type:"image",mimeType:"image/png",src:"/assets/static/external_box.42db587.4db5df91a09122be688f2b70ef8c94d3.png",size:{width:2560,height:1856},sizes:"(max-width: 2560px) 100vw, 2560px",srcset:["/assets/static/external_box.82a2fbd.4db5df91a09122be688f2b70ef8c94d3.png 480w","/assets/static/external_box.cbab2cf.4db5df91a09122be688f2b70ef8c94d3.png 1024w","/assets/static/external_box.2665e34.4db5df91a09122be688f2b70ef8c94d3.png 1920w","/assets/static/external_box.42db587.4db5df91a09122be688f2b70ef8c94d3.png 2560w"],dataUri:"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 1856' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-5c25bd8980f5cef95e056ffd0d9f1d7c'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-5c25bd8980f5cef95e056ffd0d9f1d7c)' width='2560' height='1856' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAACXBIWXMAAAsSAAALEgHS3X78AAANAUlEQVRo3uWaC1CV1RbHv%2b8cHvE6HA5KHuRer2AeHCluNj5uiN0cJ8cZp4eTmY0zZmZlpmbjtdGCTFOvt0bNJB%2bMcDNT4AgiZpiJJqBhWalpgqCRykvQfEZleu5v7b7vDNdQyczC9syavb/93muv9V9r7XM07TqnMWPGaB6PR5fy%2b%2b%2b/v4Cy5913350u3xQtbdq00W7olJiY6GVAQUFBqjAgPz//PyYDQkJCboyDbtiwQeXz58%2bXg1kvIh9p69Wrl/3pp58e2KNHj5uoa66f1eVyqXkmTpzY%2bpiQkpLSkm5XvPL4%2bPjWd3i3263EfO7cufa9e/curqysXHXgwIGMI0eOZH711VeZ5eXlGVB2SUlJ4aFDh1Td119/rejw4cMZUM7%2b/fvnh4aG%2bss8zzzzTOtiwKZNmyySr1q1KrqhocFz7tw5T21trefEiROeH374QeWnTp3yXLhwwXP69GnPN998o8qNjY3q%2b8cff/RUVVVdePzxx8NlnuTkZL1VHPzNN99UeWpqqtrw66%2b/Hvbll1/O45aXcaNpUDrSkM5Np1dUVPwX6VjB7acdPHgw3SQkJY265bTN7t%2b/f4Dgw9133y0YoT3wwAPanzLJ4VtFmj17tlnUt23bFl9WVtabm%2b6NFCRy%2b73R%2b97kidx0wtatW/si2qONOtVHykKMS0QSepeWliYWFhbGmUy48847/9gMWL9%2bvRL9V199NZxDHjp27JgHcfYcPXrUAwB6ADeVV1dXe2pqalRZCH1XGGF%2bSzvjLwg2MGYvUyownDx58u93OG5C5R9%2b%2bKH2xRdfaOixxkY1bkvbtWuXhp5rxcXFigFLly69me8TAnTovAK2uro6dTjJjx8/7hHmyLcwQg4qVF9fr9oFJBnvOXnypDDnsK%2bvb6DM%2b9JLL7UOVejSpYsvTBkNk6ZBSYhzMoxoSkmI%2blT6zOKgSdx2spDZLmUZB03fuXPnSFMFVq5cqX377beqfP78eS82XDeM%2bD3BqGfPnvqAAQP0wMBA3d/fXw8ICNDDwsJUm91u/%2b03sGLFCqvkH3/8ccInn3xyYN%2b%2bfWXcYhkAVvb555%2bXoRaSl0KV9NnMhv3uv/9%2bv3Xr1jnWrFljf%2bedd%2byLFy%2b2L1y40J6VlRU6fvz4iLi4uERu1Z6Tk6PqpV36ZWRk2PPy8hxdu3b1u9K%2bAEb9ut4%2beT8JYsRZAaU9e/bsUTkMUHor6bvvvisvKirqAZP2UH989%2b7dtZTrsAh1qIMiykepPwGG1DGHt1764QPUUnecPjthVjuwJgLGZlKf89FHH6367LPPsj799NP1zD3oekimAwpD7ETebAQwUVu2bOmNt5dAsJPwyiuvJCxatChhyZIlCdxeAhvs88Ybb8Sjv4XCDEF%2b0xpwWA%2bH9NCmkB7pUd%2bYQAWWHFiRgKC0S2LMKtZtQ4A1jhB6PNIyjhB6LBIyEYnpQ1sgqiB7tBsUZuQSW990LRhwM%2bQrRLwuubUlg9hsIlaghjM04gqfhgFnuLGzctscroqD1xiSUY0EVcMoKZ%2bRfrjFp0WQsAyVa9eu7Xa5dTp16uRn7q8JyR5DDfrVKaw5dbgCKb0cPnx4xIwZMzpPnz495u233%2b5EkBS9cePGEUjJJGgi5aQdO3ZMwCmahOM0Kjs7u9OyZctipk6dGjNz5szODz/8cHiT9fRm6JKqGhEREWAjSfnll1/WN2/erH/wwQc60qkZcUqLGRDe0o4Wi0Xr1u2nCzt79qyluT4cdgYgmo95ywEs11DOJl8HZsxtrj9%2bgJqnb9%2b%2bP2uzWn8SRgC0uaE%2bpgP1a1P41QLmoEGDgsaNGxf65JNP2p577rlQbiJ0wYIFAenp6X533XWXLSQkpOeLL77oD4b4jxkzJuCFF14IJQ8dPXq0bezYsXaCn8ArgZzZRuAUhNqFrF692kadf0JCQmesSDfKflgwG/UhRJfe9wck5LdhgIia5Ji3SKzCDvS4AhAsxcsrQ/fLcHkVcbPl6PshPEEp74dUO32F9jHuILiw5dlnn1UqmJaW9jNzhxirutdeey2KeXYhSeXbt28vBVtKxVSjXpVQKXVlWI199Klkf/%2bUMYCrRYPzGh2UK4tIesnHx6dZBpjtmCGVs5CGRfDexPLly6VNiex7773n8lyUxBqY7wLi9kou7q64w%2bICS1vThNd3btasWVFNH1kkmXoMQFqM767mGHl7kHXEqsh8kmOWvXPCpGEyhvjEqgFCGgOsjY2NVnx9K06LFTCywjFrbm6uFR/e0qFDBwfgYcXsWbHFVsRMtcE09W7Hxr26DtcF/dVG33rrrbaYuXXc6jZushC/v0gIqSjiW/Jiybn5Qsyit97oV0h9CY6We9SoUSEX6znBlmasYQZfkUjThoaGhq2sx1EKiwjMivLz84ukDBOKaCtk/u2c8R/GZVpaKtXtWtKJgMVbhsstndvWkk6ZmZnNmdkWbeuyrbicMQQeGVAmN58BEmdyi5moRSZmKgN9ycET2yJtfGeKNwaKZ1Iv/VbC0VwkYZo5H9wV0Ve3wjgH49KgHPpnwRQ3ZTfj3SUlJVlIVA6SVIS0ubkNN1GmG4l0s4YbtcqinIs6pUyZMiWoqdhLmjdvnsoB2AD2uohbzmZ8Fv3dso7snX2sxwXfJPsU75FcrcG6spcs2qIFsAaYuiG6KPoisbt4YRKjm/G5GbuLbokXJ16dhLiS0OUjpnME0Agp0YKZLtFz0T8Jf%2bUtUN78pE5cZplfvEQpy5pSL%2b%2bH6L2aW75Z9xze3l%2bMUNgrso899phiMtYiUnBE5jVDbNmbiSmSy37NdwiZX/oLTsC0e%2bTGerJQ3ZkzZ2rZSA03VMsBaiXnZsQfl%2b%2bj4ptzIFUnJN9sshpP7yTSIz8C6OabAaQb0iXIXM7m6vEJauhfCzNkHTUH7q/kdUhQFTdUxT6q2FgVfavod4QyVfU7cLUvGeoNGzbMxqF3w9w6xh0BlKuKi4uruOEqpKoaSauDaoW47FqYUvv999/XwIR6nK7uGnbSgg/fbunSpU78eCdi58TndiIqTgY4QdlIxKwruRPR8ZJ8A0pOQKg9JshuWoH77rtPkZnmzJnTlhuMTElJcZI7EWMnaO6Ewe3w%2bKK4yb8nJSV1Tk5Ojn3iiSdceI6ukSNHuh599FEXbV0GDx4cLb8d%2bPn52XCybDg%2boZDNJMEQfI0YxsSOGDHC9fzzz7vwImOZ7xbmiEd9YnGvI8CLSNZ04n84ZS%2boUDvGtRgEA6/UgRu4WidLN9THchH5GPW%2bt912W2BsbKxQkMPhaMt3QMeOHQOjo6MDpc0AOp9m5rhyzCI/ViLaujxxXSbFXMYLsyABuikB3LIi8%2besgoICHfGWB9L/I4BQRyyvJo6P%2baUeKVGjDgB615b9ALK6AlLxAyRNmzYtAL1eCDCthrIADDfAkQWgrGbwZr6zAEa3UZ9Jng/iDjeZcC38bVTA6%2bKDPf9mvTyxHmI5xFKARdm4s4WC9KihshjUyb7y0P2Z5oER/ZYvymS64cC0ZbILJpqKRTBJvCnTWxNkFvSWBJhlGItarwUDTFe3e/fuwYCUegyQ/Qhimw%2bpYi1kP5KLpTh//rzpYVYZaqC81F/y0qsWRWxtxOR7OOQpDlbPDTfA2QbyY9z4MRatN%2brrYUAN3%2bdAcZPr1/pJygfJ20QscAbGi4WqR0XrkYZ6EP44e25grw2gfgNMOcrhz%2bIxFpiWiH4tX%2bnee%2b/1RlN4WwG4jyFYgGAsQTCOQjAucHC/fv2iJ02aFI5P7gBhHaC2A3QN79WrlzgovsQN8iBxSdJ13Q8vsVlirL%2bQUfYLCgpSYwYOHBj61FNPtRk6dKhjyJAhDvTVwfptQPq/sd8gcCt48uTJweBPMFYshCjzJlMF7rjjjmv%2bJBZo/IwdfBGJabI3eYpqltq3bx%2bGWDvi4uLC4uPjHbfeeqs8djrYaGhkZGQHl8vV9vbbb7dLvdknKipK2myGq2yuF3K5%2bP6q3gVBSJUTcqqoUH7kwG4qwsFRKP4bv7VKnBH0Swbgg%2bjyI4y5T9kzIOltx8H5Y/w4gi9uMQB2CDiyEczIraioyCPPw%2bKspZzLxreA4Bthdi56vZZ61c7BcsGajeh8f5kDxLdorSlhprzWAV9c/RlKfHKxJhJnGL/9qTpBdbEsguxmDC8vxZJg0pRraWmuWyIO1/Dn1aa50TmeZpIcWg7KbatgpbmEP/%2bvVskA%2bX8QfoVuqMIt2OZH%2bH6QfDD5YPDmIRjzIPo8AkR/BDP3IPUPSZuQ9IOGYon%2bKnMQMOlaa0yIc0tigcsmAbxWl1JTUzVib1UW/xvPzkrobAUDrDg2VqyPb5MfXZQVIDbwwbtTfaQvTo4Vn0Q33u%2b0GyYRBqucENYPhysDU%2bt97LvE%2b/6NlfA2LYY9TzBffvDmOhk2XL/hGSBP8WbUhx8wXX4mMytwbbU/RZowYcLP6vr06XPd9/E/WYyWjWLRB04AAAAASUVORK5CYII=' /%3e%3c/svg%3e"}},"62rG":function(t,a,s){"use strict";s.r(a);var n=s("7uw+"),e=s("UQSp"),o=s("oCYn");function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}o.default.config.optionMergeStrategies;var c={VueRemarkRoot:e.a},r=function(t){var a=t.options.components=t.options.components||{},s=t.options.computed=t.options.computed||{};Object.keys(c).forEach((function(t){"object"===i(c[t])&&"function"==typeof c[t].render||"function"==typeof c[t]&&"function"==typeof c[t].options.render?a[t]=c[t]:s[t]=function(){return c[t]}}))},p=o.default.config.optionMergeStrategies,v="__vueRemarkFrontMatter",l={excerpt:null,weight:10,title:"How to run a box outside the cluster"};var _=function(t){t.options[v]&&(t.options[v]=l),o.default.util.defineReactive(t.options,v,l),t.options.computed=p.computed({$frontmatter:function(){return t.options[v]}},t.options.computed)},u=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("VueRemarkRoot",[n("h1",{attrs:{id:"how-to-run-a-box-outside-the-cluster"}},[n("a",{attrs:{href:"#how-to-run-a-box-outside-the-cluster","aria-hidden":"true"}},[t._v("#")]),t._v("How to run a box outside the cluster")]),n("p",[t._v("th2 provides the capability to run external components as part of the th2 Kubernetes cluster. \nTypical use cases of the "),n("code",{pre:!0},[t._v("externalBox")]),t._v(" feature include:")]),n("ul",[n("li",[t._v("testing and debugging a new box")]),n("li",[t._v("running the scripts for specific tasks (including testing activities)")]),n("li",[t._v("running th2 components that are used on-demand")])]),n("h2",{attrs:{id:"prerequisites"}},[n("a",{attrs:{href:"#prerequisites","aria-hidden":"true"}},[t._v("#")]),t._v("Prerequisites")]),n("p",[t._v("1) A th2 cluster and a box with the "),n("code",{pre:!0},[t._v("externalBox")]),t._v(" option specified in its config.")]),n("p",[t._v("2) Kubectl installed and connected to the Kubernetes cluster (not required if you are defining the config for the "),n("code",{pre:!0},[t._v("externalBox")]),t._v(" manually).")]),n("p",[t._v("3) "),n("strong",[t._v("common")]),t._v(" library used in the external component’s code:")]),n("ul",[n("li",[t._v("Java / Kotlin – "),n("a",{attrs:{href:"https://github.com/th2-net/th2-common-j",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("th2-common-j")]),t._v("  version 3.9.1 and above.")]),n("li",[t._v("Python – "),n("a",{attrs:{href:"https://github.com/th2-net/th2-common-py",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("th2-common-py")]),t._v(".")])]),n("h2",{attrs:{id:"running-external-box"}},[n("a",{attrs:{href:"#running-external-box","aria-hidden":"true"}},[t._v("#")]),t._v("Running external box")]),n("p",[t._v("To run an external box in your th2 Kubernetes cluster, follow the steps as per the algorithm below.")]),n("p",[n("g-image",{attrs:{src:s("/HrQ"),alt:"message_chain_with_two_checkpoints"}})],1),n("h2",{attrs:{id:"1-configure-th2box-custom-resource"}},[n("a",{attrs:{href:"#1-configure-th2box-custom-resource","aria-hidden":"true"}},[t._v("#")]),t._v("1. Configure th2box custom resource")]),n("p",[t._v("With "),n("code",{pre:!0},[t._v("externalBox")]),t._v(", you can configure boxes that will run outside Kubernetes cluster. \nTo do that, add the "),n("code",{pre:!0},[t._v("externalBox")]),t._v(" details into the "),n("code",{pre:!0},[t._v("extended-settings")]),t._v(" section of the component’s "),n("term",{attrs:{term:"Custom resource"}},[t._v("custom resource")]),t._v(".")],1),n("p",[t._v("First, add "),n("code",{pre:!0},[t._v("externalBox.enabled: true")]),t._v(" to the existing CR box. \nThen, provide the address for the RabbitMQ server using the "),n("code",{pre:!0},[t._v("address")]),t._v(" field. \nFinally, specify the internal mapping for the ports in the "),n("code",{pre:!0},[t._v("endpoints")]),t._v(" list by giving a "),n("code",{pre:!0},[t._v("name")]),t._v(" to the port and providing its number as a "),n("code",{pre:!0},[t._v("targetPort")]),t._v(" value.")]),n("notice",{attrs:{warning:""}},[n("p",[t._v("If an external box has a pin with the "),n("code",{pre:!0},[t._v("subscribe")]),t._v(" attribute and there is a box in Kubernetes that publishes on your pin (e.g. the "),n("strong",[t._v("act")]),t._v(" component has the "),n("code",{pre:!0},[t._v("from_codec")]),t._v(" pin receiving messages from the "),n("strong",[t._v("codec")]),t._v(" via RabbitMQ), then, upon closing your external application, the messages will be accumulated in the queue, which can overfill the cluster memory. \nTo prevent that, configure the queue limit on your external box pins.")])]),n("p",[t._v("The full list of "),n("code",{pre:!0},[t._v("externalBox")]),t._v(" parameters can be found in the example below:")]),n("p",[n("code",{pre:!0},[t._v("box_config.yaml")])]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-yaml"},[n("code",{staticClass:"language-yaml"},[n("span",{staticClass:"token key atrule"},[t._v("apiVersion")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" th2.exactpro.com/v1\n"),n("span",{staticClass:"token key atrule"},[t._v("kind")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" Th2Box\n"),n("span",{staticClass:"token key atrule"},[t._v("metadata")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("name")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" box_name\n"),n("span",{staticClass:"token key atrule"},[t._v("spec")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("image-name")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" some_image_name\n  "),n("span",{staticClass:"token key atrule"},[t._v("image-version")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" some_image_version\n  "),n("span",{staticClass:"token key atrule"},[t._v("type")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" th2"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("box"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("type\n  "),n("span",{staticClass:"token key atrule"},[t._v("custom-config")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n      "),n("span",{staticClass:"token comment"},[t._v("# Depends on specific th2 component")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("pins")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n      "),n("span",{staticClass:"token comment"},[t._v("# Depends on specific th2 component")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("extended-settings")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n    "),n("span",{staticClass:"token key atrule"},[t._v("externalBox")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" \n      "),n("span",{staticClass:"token key atrule"},[t._v("enabled")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token boolean important"},[t._v("true")]),t._v("\n      "),n("span",{staticClass:"token key atrule"},[t._v("address")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" <e.g. IP"),n("span",{staticClass:"token punctuation"},[t._v(">")]),t._v("\n      "),n("span",{staticClass:"token key atrule"},[t._v("endpoints")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n        "),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v(" "),n("span",{staticClass:"token key atrule"},[t._v("name")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v("'grpc'")]),t._v("\n          "),n("span",{staticClass:"token key atrule"},[t._v("targetPort")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token number"},[t._v("8080")]),t._v("\n")])]),n("copy-code-btn")],1),n("h2",{attrs:{id:"2-create-a-box-with-th2-common-library"}},[n("a",{attrs:{href:"#2-create-a-box-with-th2-common-library","aria-hidden":"true"}},[t._v("#")]),t._v("2. Create a box with th2-common library")]),n("p",[n("code",{pre:!0},[t._v("th2-common")]),t._v(" is a special library that implements an API for th2 components. \nIt is available for two programming languages: Java/Kotlin – "),n("a",{attrs:{href:"https://github.com/th2-net/th2-common-j",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("th2-common-j")]),t._v("  and Python – "),n("a",{attrs:{href:"https://github.com/th2-net/th2-common-py",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("th2-common-py")]),t._v(".")]),n("notice",{attrs:{note:""}},[n("p",[n("code",{pre:!0},[t._v("th2-common")]),t._v(" must be implemented in the module for running it as an "),n("em",[t._v("external box")]),t._v(".")])]),n("p",[t._v("You can create your own module or download a ready-made one.\nExamples of the repositories with "),n("code",{pre:!0},[t._v("th2-common")]),t._v(" implemented:")]),n("ul",[n("li",[t._v("Java/Kotlin – "),n("a",{attrs:{href:"https://github.com/th2-net/th2-sim-template/",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("th2-sim-template")])]),n("li",[t._v("Python – "),n("a",{attrs:{href:"https://github.com/th2-net/th2-demo-script/",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("th2-demo-script")])])]),n("p",[t._v("More details about "),n("code",{pre:!0},[t._v("th2-common")]),t._v(" can be found "),n("a",{attrs:{href:"../../fundamentals/th2-common/"}},[t._v("here")])]),n("h2",{attrs:{id:"21-provide-connection-configs-for-th2-common-library"}},[n("a",{attrs:{href:"#21-provide-connection-configs-for-th2-common-library","aria-hidden":"true"}},[t._v("#")]),t._v("2.1. Provide connection configs for th2-common library")]),n("p",[t._v("To link your "),n("em",[t._v("external box")]),t._v(" with the boxes inside the th2 cluster, "),n("code",{pre:!0},[t._v("th2-common")]),t._v(" needs connection configs. \nThere are three options to provide these configs – manually, using kubectl, or using arguments in a startup command.")]),n("h3",{attrs:{id:"211-providing-connection-configs-via-kubectl"}},[n("a",{attrs:{href:"#211-providing-connection-configs-via-kubectl","aria-hidden":"true"}},[t._v("#")]),t._v("2.1.1. Providing connection configs via kubectl")]),n("notice",{attrs:{note:""}},[n("p",[t._v("To provide configs using this method, you need to have kubectl installed on your machine.")])]),n("p",[t._v("1) Get your "),n("a",{attrs:{href:"https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("service account token")]),t._v(" (you can find details in "),n("a",{attrs:{href:"https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("Managing Service Accounts page")]),t._v(").")]),n("p",[t._v("2) Configure Kubernetes context using kubectl (you can find detailed information in "),n("a",{attrs:{href:"https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("Kubernetes documentation")]),t._v(").")]),n("p",[t._v("To specify the config details, use the following CLI commands:")]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-shell"},[n("code",{staticClass:"language-shell"},[t._v("kubectl config set-credentials "),n("span",{staticClass:"token operator"},[t._v("<")]),t._v("service-account-name"),n("span",{staticClass:"token operator"},[t._v(">")]),t._v(" --token"),n("span",{staticClass:"token operator"},[t._v("=")]),n("span",{staticClass:"token operator"},[t._v("<")]),t._v("token"),n("span",{staticClass:"token operator"},[t._v(">")]),t._v("\nkubectl config set-cluster "),n("span",{staticClass:"token operator"},[t._v("<")]),t._v("cluster-name"),n("span",{staticClass:"token operator"},[t._v(">")]),t._v(" --server"),n("span",{staticClass:"token operator"},[t._v("=")]),t._v("https://5.6.7.8 --insecure-skip-tls-verify\nkubectl config set-context "),n("span",{staticClass:"token operator"},[t._v("<")]),t._v("context-name"),n("span",{staticClass:"token operator"},[t._v(">")]),t._v(" --cluster"),n("span",{staticClass:"token operator"},[t._v("=")]),n("span",{staticClass:"token operator"},[t._v("<")]),t._v("cluster-name"),n("span",{staticClass:"token operator"},[t._v(">")]),t._v(" --namespace"),n("span",{staticClass:"token operator"},[t._v("=")]),n("span",{staticClass:"token operator"},[t._v("<")]),t._v("namespace"),n("span",{staticClass:"token operator"},[t._v(">")]),t._v(" --user"),n("span",{staticClass:"token operator"},[t._v("=")]),n("span",{staticClass:"token operator"},[t._v("<")]),t._v("service-account-name"),n("span",{staticClass:"token operator"},[t._v(">")]),t._v("\n")])]),n("copy-code-btn")],1),n("p",[t._v("Alternatively, you can provide the values by changing the "),n("code",{pre:!0},[t._v(".kube/config.yaml")]),t._v(" file manually:")]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-yaml"},[n("code",{staticClass:"language-yaml"},[n("span",{staticClass:"token key atrule"},[t._v("apiVersion")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" v1\n "),n("span",{staticClass:"token key atrule"},[t._v("clusters")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n "),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v(" "),n("span",{staticClass:"token key atrule"},[t._v("cluster")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n     "),n("span",{staticClass:"token key atrule"},[t._v("insecure-skip-tls-verify")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token boolean important"},[t._v("true")]),t._v("\n     "),n("span",{staticClass:"token key atrule"},[t._v("server")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" https"),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("//5.6.7.8\n   "),n("span",{staticClass:"token key atrule"},[t._v("name")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" <cluster"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("name"),n("span",{staticClass:"token punctuation"},[t._v(">")]),t._v("\n "),n("span",{staticClass:"token key atrule"},[t._v("contexts")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n "),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v(" "),n("span",{staticClass:"token key atrule"},[t._v("context")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n     "),n("span",{staticClass:"token key atrule"},[t._v("cluster")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" <cluster"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("name"),n("span",{staticClass:"token punctuation"},[t._v(">")]),t._v("\n     "),n("span",{staticClass:"token key atrule"},[t._v("namespace")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" <namespace"),n("span",{staticClass:"token punctuation"},[t._v(">")]),t._v("\n     "),n("span",{staticClass:"token key atrule"},[t._v("user")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" <service"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("account"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("name"),n("span",{staticClass:"token punctuation"},[t._v(">")]),t._v("\n   "),n("span",{staticClass:"token key atrule"},[t._v("name")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" <context"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("name"),n("span",{staticClass:"token punctuation"},[t._v(">")]),t._v("\n "),n("span",{staticClass:"token key atrule"},[t._v("current-context")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"<context-name>"')]),t._v("\n "),n("span",{staticClass:"token key atrule"},[t._v("kind")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" Config\n "),n("span",{staticClass:"token key atrule"},[t._v("preferences")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n "),n("span",{staticClass:"token key atrule"},[t._v("users")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n "),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v(" "),n("span",{staticClass:"token key atrule"},[t._v("name")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" <service"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("account"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("name"),n("span",{staticClass:"token punctuation"},[t._v(">")]),t._v("\n   "),n("span",{staticClass:"token key atrule"},[t._v("user")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n     "),n("span",{staticClass:"token key atrule"},[t._v("token")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" <token"),n("span",{staticClass:"token punctuation"},[t._v(">")]),t._v("\n")])]),n("copy-code-btn")],1),n("spoiler",{attrs:{title:"Code examples"}},[n("p",[t._v("Python example:")]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-python"},[n("code",{staticClass:"language-python"},[t._v("factory "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" CommonFactory"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("create_from_kubernetes"),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("\n      namespace"),n("span",{staticClass:"token operator"},[t._v("=")]),n("span",{staticClass:"token string"},[t._v('"th2-schema"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" \n      box_name"),n("span",{staticClass:"token operator"},[t._v("=")]),n("span",{staticClass:"token string"},[t._v('"script-entry-point"')]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n")])]),n("copy-code-btn")],1),n("p",[t._v("Java example:")]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-java"},[n("code",{staticClass:"language-java"},[n("span",{staticClass:"token keyword"},[t._v("var")]),t._v(" factory "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),n("span",{staticClass:"token class-name"},[t._v("CommonFactory")]),n("span",{staticClass:"token punctuation"},[t._v(".")]),n("span",{staticClass:"token function"},[t._v("createFromKubernetes")]),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("\n      namespace"),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" \n      boxName"),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" \n      contextName"),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n")])]),n("copy-code-btn")],1)]),n("p",[t._v("More details about this option "),n("a",{attrs:{href:"../../fundamentals/th2-common/#option-2-access-config-files-from-the-kubernetes-cluster"}},[t._v("here")])]),n("p",[t._v("After completion of this step, "),n("a",{attrs:{href:"./#31-run-without-arguments"}},[t._v("run your box without arguments")]),t._v(".")]),n("h3",{attrs:{id:"212-provide-connection-configs-manually"}},[n("a",{attrs:{href:"#212-provide-connection-configs-manually","aria-hidden":"true"}},[t._v("#")]),t._v("2.1.2. Provide connection configs manually")]),n("p",[n("code",{pre:!0},[t._v("CommonFactory")]),t._v(" is a class that contains a set of tools for creating connections between boxes in th2 cluster and module developed.\nEssentially, it transfers the "),n("code",{pre:!0},[t._v(".json")]),t._v(" configuration files to the "),n("code",{pre:!0},[t._v("CommonFactory")]),t._v(" object:")]),n("ul",[n("li",[n("code",{pre:!0},[t._v("grpc.json")])]),n("li",[n("code",{pre:!0},[t._v("mq.json")])]),n("li",[n("code",{pre:!0},[t._v("rabbit.json")])])]),n("p",[t._v("Configuration of these files varies depending on the components that are to be in interaction with your component.")]),n("p",[n("a",{attrs:{href:"../../fundamentals/th2-common/#th2-common-integrations-configuration"}},[t._v("integrations")])]),n("spoiler",{attrs:{title:"Passing .json files to CommonFactory"}},[n("p",[t._v("Python example:")]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-python"},[n("code",{staticClass:"language-python"},[n("span",{staticClass:"token keyword"},[t._v("from")]),t._v(" th2_common"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("schema"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("factory"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("common_factory "),n("span",{staticClass:"token keyword"},[t._v("import")]),t._v(" CommonFactory\n\nfactory "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" CommonFactory"),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("\n    grpc_router_config_filepath"),n("span",{staticClass:"token operator"},[t._v("=")]),n("span",{staticClass:"token string"},[t._v('"./configs/grpc.json"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n    rabbit_mq_config_filepath"),n("span",{staticClass:"token operator"},[t._v("=")]),n("span",{staticClass:"token string"},[t._v('"./configs/rabbitMQ.json"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n    mq_router_config_filepath"),n("span",{staticClass:"token operator"},[t._v("=")]),n("span",{staticClass:"token string"},[t._v('"./configs/mq.json"')]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n")])]),n("copy-code-btn")],1),n("p",[t._v("Java example:")]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-java"},[n("code",{staticClass:"language-java"},[n("span",{staticClass:"token keyword"},[t._v("import")]),t._v(" "),n("span",{staticClass:"token namespace"},[t._v("com"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("exactpro"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("th2"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("common"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("schema"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("factory"),n("span",{staticClass:"token punctuation"},[t._v(".")])]),n("span",{staticClass:"token class-name"},[t._v("CommonFactory")]),n("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n\n"),n("span",{staticClass:"token class-name"},[t._v("CommonFactory")]),t._v(" factory "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),n("span",{staticClass:"token class-name"},[t._v("CommonFactory")]),n("span",{staticClass:"token punctuation"},[t._v(".")]),n("span",{staticClass:"token function"},[t._v("createFromArguments")]),n("span",{staticClass:"token punctuation"},[t._v("(")]),n("span",{staticClass:"token string"},[t._v('"--configs"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"./configs"')]),n("span",{staticClass:"token punctuation"},[t._v(")")]),n("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n")])]),n("copy-code-btn")],1)]),n("spoiler",{attrs:{title:"The .json files"}},[n("p",[t._v("Configuration examples can be found below. \nDocuments for downloading and modifications "),n("a",{attrs:{href:"https://github.com/th2-net/th2-common-py/tree/e99d8df8e164f840daeb39eb66410a5022493c34/test/test_configuration/resources/json_configuration",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("here")]),t._v(":")]),n("p",[n("strong",[t._v("gRPC.json file")])]),n("p",[t._v("It contains the host and ports of components for interaction ("),n("strong",[t._v("act")]),t._v(" and "),n("strong",[t._v("check1")]),t._v(" in this example). \n"),n("code",{pre:!0},[t._v("service-class")]),t._v(" parameter - in this case it is "),n("code",{pre:!0},[t._v("ActService")]),t._v(" or "),n("code",{pre:!0},[t._v("Check1Service")]),t._v(". \n"),n("code",{pre:!0},[t._v("ports")]),t._v(" is an external ports of the pods to interact with - "),n("strong",[t._v("act")]),t._v(" and "),n("strong",[t._v("check1")]),t._v(" pods here.\n"),n("code",{pre:!0},[t._v("host")]),t._v(" parameter is for kubernetes cluster hostname (cluster IP). You have several options where you can find this information:")]),n("ul",[n("li",[t._v("Kubernetes Dashboard → Services")]),n("li",[t._v("CLI → "),n("code",{pre:!0},[t._v("kubectl get services")])])]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-json"},[n("code",{staticClass:"language-json"},[n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n  "),n("span",{staticClass:"token property"},[t._v('"services"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    "),n("span",{staticClass:"token property"},[t._v('"Act"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"service-class"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"ActService"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"endpoints"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n        "),n("span",{staticClass:"token property"},[t._v('"act"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n          "),n("span",{staticClass:"token property"},[t._v('"host"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"<kubernetes cluster hostname>"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n          "),n("span",{staticClass:"token property"},[t._v('"port"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" <external port of act pod>\n        "),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n      "),n("span",{staticClass:"token punctuation"},[t._v("}")]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"strategy"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n        "),n("span",{staticClass:"token property"},[t._v('"name"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"robin"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n        "),n("span",{staticClass:"token property"},[t._v('"endpoints"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("[")]),n("span",{staticClass:"token string"},[t._v('"act"')]),n("span",{staticClass:"token punctuation"},[t._v("]")]),t._v("\n      "),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n    "),n("span",{staticClass:"token punctuation"},[t._v("}")]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n    "),n("span",{staticClass:"token property"},[t._v('"Check1"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"service-class"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"Check1Service"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"endpoints"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n        "),n("span",{staticClass:"token property"},[t._v('"check1"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n          "),n("span",{staticClass:"token property"},[t._v('"host"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"<kubernetes cluster hostname>"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n          "),n("span",{staticClass:"token property"},[t._v('"port"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" <external port of check1 pod>\n        "),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n      "),n("span",{staticClass:"token punctuation"},[t._v("}")]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"strategy"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n        "),n("span",{staticClass:"token property"},[t._v('"name"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"robin"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n        "),n("span",{staticClass:"token property"},[t._v('"endpoints"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("[")]),n("span",{staticClass:"token string"},[t._v('"check1"')]),n("span",{staticClass:"token punctuation"},[t._v("]")]),t._v("\n      "),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n    "),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n  "),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n"),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),n("copy-code-btn")],1),n("p",[n("strong",[t._v("MQ.json file")])]),n("p",[t._v("It contains information about the "),n("strong",[t._v("routing-key")]),t._v(" from the external box (named "),n("strong",[t._v("script-entry-point")]),t._v(" in this example) to the estore. \nYou can find this information in several places:")]),n("ul",[n("li",[t._v("Kubernetes Dashboard → ConfigMaps → script-entry-point-app-config")]),n("li",[t._v("RabbitMQ "),n("code",{pre:!0},[t._v("event-store-pin")]),t._v(" queue")])]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-json"},[n("code",{staticClass:"language-json"},[n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n  "),n("span",{staticClass:"token property"},[t._v('"queues"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    "),n("span",{staticClass:"token property"},[t._v('"event-store-pin"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"attributes"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("[")]),t._v("\n        "),n("span",{staticClass:"token string"},[t._v('"event"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n        "),n("span",{staticClass:"token string"},[t._v('"publish"')]),t._v("\n      "),n("span",{staticClass:"token punctuation"},[t._v("]")]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"exchange"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"fill with rabbit exchange name"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"filters"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("[")]),n("span",{staticClass:"token punctuation"},[t._v("]")]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"name"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"fill with routing key of script to estore"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n      "),n("span",{staticClass:"token property"},[t._v('"queue"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"not_necessary"')]),t._v("\n    "),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n  "),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n"),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),n("copy-code-btn")],1),n("p",[n("strong",[t._v("RabbitMQ.json file")])]),n("p",[t._v("It contains RabbitMQ credentials. Possible data sources:")]),n("ul",[n("li",[t._v("Kubernetes dashboard → ConfigMaps → rabbit-mq-app-config")]),n("li",[t._v("RabbitMQ credentials configured in secrets (can be found below)")])]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-json"},[n("code",{staticClass:"language-json"},[n("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n  "),n("span",{staticClass:"token property"},[t._v('"host"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"<kubernetes cluster hostname>"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n  "),n("span",{staticClass:"token property"},[t._v('"vHost"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"vHost from RabbitMQ. Equal to namespace name by default"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n  "),n("span",{staticClass:"token property"},[t._v('"port"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"<external port of RabbitMQ>"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n  "),n("span",{staticClass:"token property"},[t._v('"username"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"<RabbitMQ username>"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n  "),n("span",{staticClass:"token property"},[t._v('"password"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"<RabbitMQ password>"')]),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n  "),n("span",{staticClass:"token property"},[t._v('"exchangeName"')]),n("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"<queue exchange. demo_example by default>"')]),t._v("\n"),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),n("copy-code-btn")],1),n("p",[n("code",{pre:!0},[t._v("secrets.yaml")])]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-yaml"},[n("code",{staticClass:"language-yaml"},[n("span",{staticClass:"token key atrule"},[t._v("rabbitmq")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n"),n("span",{staticClass:"token comment"},[t._v("# set admin user credentials, that will be created during deployment")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("rabbitmqUsername")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" th2\n  "),n("span",{staticClass:"token key atrule"},[t._v("rabbitmqPassword")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" rab"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("pass\n  "),n("span",{staticClass:"token comment"},[t._v("# must be a random string")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("rabbitmqErlangCookie")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" cookie\n")])]),n("copy-code-btn")],1)]),n("p",[t._v("After transferring "),n("code",{pre:!0},[t._v(".json")]),t._v(" files, you need to create MQ routers and gRPC services. \nThey act as connectors to the required modules.")]),n("spoiler",{attrs:{title:"Example of creating gRPC routers"}},[n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-python"},[n("code",{staticClass:"language-python"},[n("span",{staticClass:"token keyword"},[t._v("from")]),t._v(" th2_common"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("schema"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("factory"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("common_factory "),n("span",{staticClass:"token keyword"},[t._v("import")]),t._v(" CommonFactory\n"),n("span",{staticClass:"token keyword"},[t._v("from")]),t._v(" th2_grpc_act_template"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("act_service "),n("span",{staticClass:"token keyword"},[t._v("import")]),t._v(" ActService\n"),n("span",{staticClass:"token keyword"},[t._v("from")]),t._v(" th2_grpc_check1"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("check1_service "),n("span",{staticClass:"token keyword"},[t._v("import")]),t._v(" Check1Service\n\n"),n("span",{staticClass:"token keyword"},[t._v("def")]),t._v(" "),n("span",{staticClass:"token function"},[t._v("connect")]),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("config_path"),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" tries"),n("span",{staticClass:"token operator"},[t._v("=")]),n("span",{staticClass:"token number"},[t._v("3")]),n("span",{staticClass:"token punctuation"},[t._v(")")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n    "),n("span",{staticClass:"token keyword"},[t._v("try")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n        logging"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("info"),n("span",{staticClass:"token punctuation"},[t._v("(")]),n("span",{staticClass:"token string"},[t._v("'Trying to connect...'")]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n        factory "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" CommonFactory"),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("config_path"),n("span",{staticClass:"token operator"},[t._v("=")]),t._v("config_path"),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n        grpc_router "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" factory"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("grpc_router\n        act "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" grpc_router"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("get_service"),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("ActService"),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n        check "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" grpc_router"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("get_service"),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("Check1Service"),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n        estore "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" factory"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("event_batch_router\n        logging"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("info"),n("span",{staticClass:"token punctuation"},[t._v("(")]),n("span",{staticClass:"token string"},[t._v("'Connection established.'")]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n        "),n("span",{staticClass:"token keyword"},[t._v("return")]),t._v(" "),n("span",{staticClass:"token punctuation"},[t._v("{")]),n("span",{staticClass:"token string"},[t._v("'act'")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" act"),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n                "),n("span",{staticClass:"token string"},[t._v("'check'")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" check"),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n                "),n("span",{staticClass:"token string"},[t._v("'estore'")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" estore"),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n                "),n("span",{staticClass:"token string"},[t._v("'factory'")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" factory"),n("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n    "),n("span",{staticClass:"token keyword"},[t._v("except")]),t._v(" Exception "),n("span",{staticClass:"token keyword"},[t._v("as")]),t._v(" e"),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n        "),n("span",{staticClass:"token keyword"},[t._v("if")]),t._v(" tries "),n("span",{staticClass:"token operator"},[t._v(">")]),t._v(" "),n("span",{staticClass:"token number"},[t._v("0")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n            logging"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("error"),n("span",{staticClass:"token punctuation"},[t._v("(")]),n("span",{staticClass:"token string"},[t._v("'Unable to connect.'")]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n            logging"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("error"),n("span",{staticClass:"token punctuation"},[t._v("(")]),n("span",{staticClass:"token builtin"},[t._v("str")]),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("e"),n("span",{staticClass:"token punctuation"},[t._v(")")]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n            logging"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("info"),n("span",{staticClass:"token punctuation"},[t._v("(")]),n("span",{staticClass:"token string"},[t._v("'Retry in 3...'")]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n            "),n("span",{staticClass:"token keyword"},[t._v("print")]),n("span",{staticClass:"token punctuation"},[t._v("(")]),n("span",{staticClass:"token string-interpolation"},[n("span",{staticClass:"token string"},[t._v("f'Unable to connect: \\n ")]),n("span",{staticClass:"token interpolation"},[n("span",{staticClass:"token punctuation"},[t._v("{")]),n("span",{staticClass:"token builtin"},[t._v("str")]),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("e"),n("span",{staticClass:"token punctuation"},[t._v(")")]),n("span",{staticClass:"token punctuation"},[t._v("}")])]),n("span",{staticClass:"token string"},[t._v("'")])]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n            time"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("sleep"),n("span",{staticClass:"token punctuation"},[t._v("(")]),n("span",{staticClass:"token number"},[t._v("3")]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n            connect"),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("config_path"),n("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" tries"),n("span",{staticClass:"token operator"},[t._v("-")]),n("span",{staticClass:"token number"},[t._v("1")]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n        "),n("span",{staticClass:"token keyword"},[t._v("else")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n            "),n("span",{staticClass:"token keyword"},[t._v("raise")]),t._v("\n")])]),n("copy-code-btn")],1)]),n("p",[t._v("More details about this option "),n("a",{attrs:{href:"../../fundamentals/th2-common/#option-1-user-creates-the-configuration-files-and-then-provides-the-path-to-these-files"}},[t._v("here")])]),n("p",[t._v("After completion of this step, "),n("a",{attrs:{href:"#31-run-without-arguments"}},[t._v("run your box without arguments")]),t._v(".")]),n("h3",{attrs:{id:"213-provide-configs-using-cli-command-arguments"}},[n("a",{attrs:{href:"#213-provide-configs-using-cli-command-arguments","aria-hidden":"true"}},[t._v("#")]),t._v("2.1.3. Provide configs using CLI command arguments")]),n("p",[t._v("The "),n("em",[t._v("external box")]),t._v(", configured via arguments passed to the CLI run command, is created the following way (see examples for specific programming languages below):\nIn Java/Kotlin, use the "),n("code",{pre:!0},[t._v("createFromArguments")]),t._v(" method of the "),n("code",{pre:!0},[t._v("CommonFactory")]),t._v(" class:")]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-java"},[n("code",{staticClass:"language-java"},[n("span",{staticClass:"token keyword"},[t._v("var")]),t._v(" factory "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),n("span",{staticClass:"token class-name"},[t._v("CommonFactory")]),n("span",{staticClass:"token punctuation"},[t._v(".")]),n("span",{staticClass:"token function"},[t._v("createFromArguments")]),n("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("args"),n("span",{staticClass:"token punctuation"},[t._v(")")]),n("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n")])]),n("copy-code-btn")],1),n("p",[t._v("In Python, use the "),n("code",{pre:!0},[t._v("create_from_arguments")]),t._v(" method of the "),n("code",{pre:!0},[t._v("CommonFactory")]),t._v(" class:")]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-python"},[n("code",{staticClass:"language-python"},[t._v("factory "),n("span",{staticClass:"token operator"},[t._v("=")]),t._v(" CommonFactory"),n("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("create_from_arguments"),n("span",{staticClass:"token punctuation"},[t._v("(")]),n("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n")])]),n("copy-code-btn")],1),n("p",[t._v("After completion of this step, "),n("a",{attrs:{href:"./#32-run-with-arguments"}},[t._v("run your box with arguments")]),t._v(".")]),n("h2",{attrs:{id:"3-run-external-box"}},[n("a",{attrs:{href:"#3-run-external-box","aria-hidden":"true"}},[t._v("#")]),t._v("3. Run external box")]),n("p",[t._v("Depending on the method used to create the component, you can run it in different ways.")]),n("h3",{attrs:{id:"31-run-without-arguments"}},[n("a",{attrs:{href:"#31-run-without-arguments","aria-hidden":"true"}},[t._v("#")]),t._v("3.1 Run without arguments")]),n("p",[t._v("The main commands to run the box are slightly different for different programming languages:")]),n("p",[t._v("Java: "),n("code",{pre:!0},[t._v("gradle run")])]),n("p",[t._v("Python: "),n("code",{pre:!0},[t._v("python run.py")])]),n("h3",{attrs:{id:"32-run-with-arguments"}},[n("a",{attrs:{href:"#32-run-with-arguments","aria-hidden":"true"}},[t._v("#")]),t._v("3.2 Run with arguments")]),n("p",[t._v("If you have not specified configs for "),n("code",{pre:!0},[t._v("th2-common")]),t._v(" to connect to the th2, you should specify them along with arguments in terminal. \nYou can use one of the groups of arguments provided below.")]),n("notice",{attrs:{note:""}},[n("p",[t._v("Arguments from different groups cannot be used together.")])]),n("p",[t._v("Local files configuration arguments:")]),n("ul",[n("li",[n("code",{pre:!0},[t._v("--rabbitConfiguration")]),t._v(" – a path to the "),n("code",{pre:!0},[t._v(".json")]),t._v(" file with RabbitMQ configuration")]),n("li",[n("code",{pre:!0},[t._v("--messageRouterConfiguration")]),t._v(" – a path to the "),n("code",{pre:!0},[t._v(".json")]),t._v(" file with configuration for MessageRouter")]),n("li",[n("code",{pre:!0},[t._v("--grpcRouterConfiguration")]),t._v(" – a path to the "),n("code",{pre:!0},[t._v(".json")]),t._v(" file with configuration for gRPCRouter")]),n("li",[n("code",{pre:!0},[t._v("--cradleConfiguration")]),t._v(" – a path to the "),n("code",{pre:!0},[t._v(".json")]),t._v(" file with configuration for Cradle")]),n("li",[n("code",{pre:!0},[t._v("--customConfiguration")]),t._v(" – a path to the "),n("code",{pre:!0},[t._v(".json")]),t._v(" file with a custom configuration")]),n("li",[n("code",{pre:!0},[t._v("--dictionariesDir")]),t._v(" – a path to the directory with encoded dictionary files")]),n("li",[n("code",{pre:!0},[t._v("--prometheusConfiguration")]),t._v(" – a path to the "),n("code",{pre:!0},[t._v(".json")]),t._v(" file with a configuration for Prometheus metrics server")]),n("li",[n("code",{pre:!0},[t._v("--boxConfiguration")]),t._v(" – a path to the "),n("code",{pre:!0},[t._v(".json")]),t._v(" file with external box")]),n("li",[n("code",{pre:!0},[t._v("-c/")]),t._v(" and "),n("code",{pre:!0},[t._v("--configs")]),t._v(" – a folder with "),n("code",{pre:!0},[t._v(".json")]),t._v(" files for schema configurations with following names:")])]),n("p",[t._v("1) rabbitMq.json – a configuration file for RabbitMQ")]),n("p",[t._v("2) mq.json – a configuration file for MessageRouter")]),n("p",[t._v("3) grpc.json – a configuration file for gRPCRouter")]),n("p",[t._v("4) cradle.json – a configuration file for the Cradle API")]),n("p",[t._v("5) custom.json – custom configuration")]),n("p",[t._v("Kubernetes-based configuration arguments:")]),n("notice",{attrs:{note:""}},[n("p",[t._v("when using these arguments, prior installation and configuration of kubectl is required")])]),n("ul",[n("li",[n("p",[n("code",{pre:!0},[t._v("--namespace")]),t._v(" – the namespace in Kubernetes to search for config maps")])]),n("li",[n("p",[n("code",{pre:!0},[t._v("--boxName")]),t._v(" – the name of the target th2 box placed in the specified Kubernetes namespace")])]),n("li",[n("p",[n("code",{pre:!0},[t._v("--contextName")]),t._v(" – the context name to search connection parameters in kubeconfig")])]),n("li",[n("p",[n("code",{pre:!0},[t._v("--dictionaries")]),t._v(" – the mapping between a dictionary in infra-schema and a dictionary type specified in the following format: "),n("code",{pre:!0},[t._v("--dictionaries <dictionary name>=<dictionary type> [<dictionary name>=<dictionary type>]")]),t._v(". \nThis argument is provided  when dictionaries are required to start a specific box.")])])]),n("p",[t._v("A CLI command example:")]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-java"},[n("code",{staticClass:"language-java"},[t._v("gradle run "),n("span",{staticClass:"token operator"},[t._v("--")]),t._v("args"),n("span",{staticClass:"token operator"},[t._v("=")]),t._v("'"),n("span",{staticClass:"token operator"},[t._v("--")]),t._v("namespace myNamespace "),n("span",{staticClass:"token operator"},[t._v("--")]),t._v("boxName myExternalBox "),n("span",{staticClass:"token operator"},[t._v("--")]),t._v("contextName myContext'\n")])]),n("copy-code-btn")],1),n("p",[t._v("With these parameters, your component will connect to the destination Kubernetes cluster and namespace, and find the right entry point (that is external box itself) to act from.")]),n("p",[t._v("Also, there are special ConfigMaps in the "),n("em",[t._v("schema")]),t._v(" namespace with the parameters for connecting to the th2 infrastructure. \n"),n("code",{pre:!0},[t._v("th2-common")]),t._v(" will save it automatically in the repository of the box you are running.")])],1)}),[],!1,null,null,null);"function"==typeof r&&r(u),"function"==typeof _&&_(u);a.default=u.exports},UQSp:function(t,a,s){"use strict";a.a={name:"VueRemarkRoot",render:function(t){return t("div",null,this.$slots.default)}}}}]);