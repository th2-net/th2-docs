(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{"78Mz":function(t,s){t.exports={type:"image",mimeType:"image/png",src:"/assets/static/infra-operator.109a16b.bda602917f8c73e25674f9bab915e9c9.png",size:{width:924,height:257},sizes:"(max-width: 924px) 100vw, 924px",srcset:["/assets/static/infra-operator.82a2fbd.bda602917f8c73e25674f9bab915e9c9.png 480w","/assets/static/infra-operator.109a16b.bda602917f8c73e25674f9bab915e9c9.png 924w"],dataUri:"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 924 257' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-2043fa026f4c7fbd63476881bd6ee22a'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-2043fa026f4c7fbd63476881bd6ee22a)' width='924' height='257' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAASCAYAAADrL9giAAAACXBIWXMAAAsSAAALEgHS3X78AAAHNklEQVRYw8VX%2bW9UVRQmcYkmRMElGhH0F/8AfzEaFdESEBDxB1B2WQtK0CgCKrIUFNkMLkEhioAVgUIKWJaydKelC1CWTgulLV1m7UxnOuu9b96b93nufTPTaZnpYkzM5OS9e9%2b7593z3e9858ygcCTiJ/OS%2bbqZpvnCapiuanROjFXDxLOe7//PpmgRH1c1eR3IukE6AFXXodE1bn2NU82lMOG/T%2bunr25%2bo74VTYeIA9F5MVb1/vkYJBwQEnrcNE0Pkz/F59KV%2bgpdsTca47CiKy03dKWpWlcURu/qxruJa5OYQu9EAPoK5DXRaANi3/IZV1X5bnwPKf11%2bWVhjXxExHLd41d1UyOXz8RYXMXzmM/Yup42SKAQHYA%2bDAoUYZrj2ZvAptwLvm60HCutJrBFz4DNHgrlVrkxp4Yh1yUxRfgiE/ftHW5YbXY4HO1odzhht7fD6XTB4/Ohuc0CO90jepoExF3ru3x2%2babABXZw%2b1UcOePH/FUOjJ1nxYqtLhRWBeW74nns/cRroqUGICuDALgPfPUoI9jm62ALh4HNfBi8tqRfAIiAgpwjr7AEFVdvoPjyVZwoq0BRVTVyy6tgIVBMpjpUVV1BGY2Zqkogkm00ERSV%2bOP2qfjjuBdzVjowaqYF4xZYsWyzEy9PNePN%2bVYs3eDEmdIA%2bUwdfO8AHN4A9u794GtehyI2decqWPpwsFlDwU3FBgAKkyBIi61PQFsAEAiFUEaBX3N2wGSxoeC6CRVmG06YbsLp9%2bNGuxOtgSCamluReyYfDU3NvTDAmAOd/uofOjBmrgXjKfC3F9vwY6aHAA7h820ujJ1rxaQPbHhjlgWHc/2SCQKIgTFAACBTIM0I1tZgADBzCHjjZTmXaLHNCerFNy8YEGIopNO90%2bmF1%2bNBTU0tLrSYcd1qQzMFL755k1KizuVGTk4u9mUelCwQqdDls8uEonTQ6U/5yIb01e3Ye9QrT/rQaR%2bqahgOUzqcLA7gl4OdmETArNrukoDxAQOQtR5s6oPgy56HUn4U/Pg2sPlPgc15HPxQBpRLJ6CUHYZScgBKbbHMSDWiRU0412QgjDMUVVxCg6cTbgLgQlklzIEAblPe3yFrcXvke3UEhrj3%2bwOSTYLm4pe4WRGEOM1LJoaJi2wy58%2bXB1HbxLFxpxul1SFs3e2Gs1OVjBg53YL5XzrQGVClv2SsSg3AoXVgMx4CXzhcCh97/1GwBcNo/DSB8BilwhADDAIp%2bNUoNLT64Qlq8AZVeOiDPqai3hyG2RFASWUVWiiwU6fO4uy5ApiI5g7GcetOCzbt%2bA1XLlXD4vOjgVhws64eIUotp1fDrVYOb0iVQid8urwq2pxhedqvUK5P/9SO4/l%2brPupQ2pCZU0It1sVmQbZ5/0Y/b5FpseNBi6B4%2bpAGECnLAEg5efpI8iGG8ETCBKIJc%2bRKNIcgRDKGEtKHoBfiZDoqQgqmsw5d4DEyhsiBlShyeuTYneR0qGJtMDOGOwkgnv2HcCunXvQ3OFBIzHg4sVKAkAhH0R1Cpxrhi9hobBGwGpYSwFPXGTF9r0eNFsVnCgKSBZQGZRpkEesEPeC/mmzLcg%2bF9WB8IAYEANghAxcGgHBZj8CfmwLFLcV/MBqsPceAP96HCIag9FTxD6gySIfYtEUcHfCK0Svpo7SwYtqqx0tZgv27tmP8/nFuEY6YKc0KaUqYezJKHU9RVAEsnyLC%2b98aMPH3zhxriyIb3e5kZXrQ0FlUFJf6EImVYglGe1IIxb8meNLKYQDB4DKoFJTaAhfeTbY5HsIgPFQeIhyV%2b8mWGpUBAUAzcQAHwV47VoNLpqtuEU5f9vuQD1ZG9E/RP5E8KIvMETwbgEUczqBImg%2beakNr82wYOondlypY6hvUWT%2bi3w/ctaPCelWvDrNjGWbnAhwLa4BAxNBynO%2b%2bFmD/sIIDDbvSfCNb8kqwdePMaoCMUCUxHAUgJ5lsIhof9XmgImCO0Ml8TIBcJKY4CRQmoj2NmqUyij461QaYxUgVe1mUSEUJW/CQqus%2bT//1Ynv93nw3e8e7CT1X7%2bjQ/YGs1c4YHGG41Ugmc/UAOxfJRshNvcJQwDjRgI4fbDxjNjApg2mZmmkZEBPAAzlVlFSWo4covnR/BJknS/CsbxiZBeUoKm1DRUEjtCFNkqJxCYoVQ8gQQgbIGT%2b7ZM5LsRQnPaLU8xS%2bAQrRGN0uZbFc7//naDo7sRG8naDr3xB9gGiGepma9Nki8wzyL54CfzXJeT87lOL3cs/W3Slvw/UpUfv5fciUuQi0T8ysZNPtdlEcBS5LiJPf/Gadizf7MJn1AkKyi%2bi8emSwF3B9w1A4keEsUDvxoPGVYCm60mDT9bMKDH/PZ7H16VoW5P19YgJpRaJNmER2SxJ2ifZT58M6LYJoep9GpJurGdQqay3zfUHBCO3BaiGyfvofH/8p2ZAL5vuLZCBBvNv7b8C9x/JDoITRj20FgAAAABJRU5ErkJggg==' /%3e%3c/svg%3e"}},"QS+v":function(t,s,e){"use strict";e.r(s);var n=e("7uw+"),a=e("UQSp"),o=e("oCYn");function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}o.default.config.optionMergeStrategies;var r={VueRemarkRoot:a.a},c=function(t){var s=t.options.components=t.options.components||{},e=t.options.computed=t.options.computed||{};Object.keys(r).forEach((function(t){"object"===i(r[t])&&"function"==typeof r[t].render||"function"==typeof r[t]&&"function"==typeof r[t].options.render?s[t]=r[t]:e[t]=function(){return r[t]}}))},p=o.default.config.optionMergeStrategies,l="__vueRemarkFrontMatter",u={excerpt:null,"tree-title":"infra-operator",weight:15,repo_owner:"th2-net",repo:"th2-infra-operator",related:[{name:"th2-net/th2-infra",icon:"mdi-github",href:"https://github.com/th2-net/th2-infra"}],title:"th2-infra-operator"};var v=function(t){t.options[l]&&(t.options[l]=u),o.default.util.defineReactive(t.options,l,u),t.options.computed=p.computed({$frontmatter:function(){return t.options[l]}},t.options.computed)},m=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("VueRemarkRoot",[n("h1",{attrs:{id:"th2-infra-operator"}},[n("a",{attrs:{href:"#th2-infra-operator","aria-hidden":"true"}},[t._v("#")]),t._v("th2-infra-operator")]),n("p",[n("strong",[t._v("infra-operator")]),t._v(" (th2 infrastructure operator) is one of th2 infra components that works with the current state of th2 system. \nIt is installed along with the th2 framework infrastructure.")]),n("p",[t._v("Basically, "),n("strong",[t._v("infra-operator")]),t._v(" is an implementation of Kubernetes custom controller. ")]),n("p",[t._v("It monitors "),n("term",{attrs:{term:"Custom resource"}},[t._v("custom resources")]),t._v(" and ensures the synchronization between them and Helm releases in the Kubernetes cluster. ")],1),n("h2",{attrs:{id:"functionality"}},[n("a",{attrs:{href:"#functionality","aria-hidden":"true"}},[t._v("#")]),t._v("Functionality")]),n("p",[n("g-image",{attrs:{src:e("78Mz"),alt:"img"}})],1),n("p",[t._v("Being the component that interacts with schema environment, "),n("strong",[t._v("infra-operator")]),t._v(" has the following objectives:")]),n("ul",[n("li",[t._v("It monitors Kubernetes events related to the th2 "),n("term",{attrs:{term:"Custom resource"}},[t._v("Custom resources")]),t._v(" and generates or modifies the corresponding Helm Releases.")],1),n("li",[t._v("Based on the config map "),n("code",{pre:!0},[t._v("rabbit-mq-app-config")]),t._v(" which is deployed by "),n("strong",[t._v("infra-mgr")]),t._v(", it creates Vhost in RabbitMQ for every schema namespace.")]),n("li",[t._v("For each Vhost it creates a user in RabbitMQ and configures its permissions.")]),n("li",[t._v("Based on the pins described in the custom resources it declares queues in RabbitMQ.")]),n("li",[t._v("It binds the queues in RabbitMQ according to "),n("code",{pre:!0},[t._v("Th2Link")]),t._v(" resources.")]),n("li",[t._v("Generates RabbitMQ configs for each resource that needs it.")]),n("li",[t._v("Generates "),n("a",{attrs:{href:"https://grpc.io/docs/",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("gRPC")]),t._v(" configs for each resource that needs it.")])]),n("p",[t._v("Mostly, "),n("strong",[t._v("infra-operator")]),t._v(" communicates with other infra components using Kubernetes as an intermediary. \nAll the interconnections are displayed on the diagram below.")]),n("img",{pre:!0,attrs:{src:"https://www.plantuml.com/plantuml/png/XPAnRiCm34HtVGMdTlBIiIY205qAj2aG0yqITA1jsXOWYm55PSotLpOIHV7IHGFl7NMaj0sAed5onb6le0nYXr6XiqAjMlP6hJg2cjF1FUZuKbdV2rPy8a5bCUPuBqw3mDjJKWBxpIzWW5GfWPjhqNABuqXkUjJ6BBRiLTZ1Psn8F2c5NAgnQQpkziPa72xniYdOL_YoGMc2FcaVwPgQ764WYASEvrvtO_TWXAlJByxtEXlCF6HLhTWTUXnetazYduksCtdBcR5zf4Z_GOUHWwwWSh0hLWmLYZsiwPybVXdw6zMUqzDIu2XjCc_9T-ah_040"}}),n("h2",{attrs:{id:"configuration"}},[n("a",{attrs:{href:"#configuration","aria-hidden":"true"}},[t._v("#")]),t._v("Configuration")]),n("p",[t._v("Settings for "),n("strong",[t._v("infra-operator")]),t._v(" should be defined in the "),n("code",{pre:!0},[t._v("infraOperator")]),t._v(" section of the values file. \nThey will be applied during deployment of "),n("strong",[t._v("infra")]),t._v(" into the Kubernetes cluster. ")]),n("p",[t._v("All possible parameters with the descriptions are provided below:")]),n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-yaml"},[n("code",{staticClass:"language-yaml"},[n("span",{staticClass:"token comment"},[t._v("# infra-operator.yml")]),t._v("\n"),n("span",{staticClass:"token comment"},[t._v("# version 1.5.4")]),t._v("\n"),n("span",{staticClass:"token key atrule"},[t._v("namespacePrefixes")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n  "),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v(" namespace"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("\n  "),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v(" prefixes"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("\n"),n("span",{staticClass:"token comment"},[t._v("# these prefixes are used to filter namespaces that infra-operator will manage as a schema")]),t._v("\n"),n("span",{staticClass:"token key atrule"},[t._v("chart")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n"),n("span",{staticClass:"token comment"},[t._v("# this section includes information about git or helm repository as a source of helm charts")]),t._v("\n"),n("span",{staticClass:"token comment"},[t._v("# you can specify either git or helm repository")]),t._v("\n  "),n("span",{staticClass:"token comment"},[t._v("# git repository parameters ")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("git")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" git@some.server.com"),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("some/repository\n  "),n("span",{staticClass:"token comment"},[t._v("# git repository URL for helm charts used by Th2 Custom Resources")]),t._v("\n  \n  "),n("span",{staticClass:"token key atrule"},[t._v("ref")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" branch\n  "),n("span",{staticClass:"token comment"},[t._v("# branch for helm charts")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("path")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" /path/to/charts\n  "),n("span",{staticClass:"token comment"},[t._v("# repository path for charts")]),t._v("\n  "),n("span",{staticClass:"token comment"},[t._v("# helm repository parameters ")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("repository")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" https"),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("//helm.server.com/some/repository\n  "),n("span",{staticClass:"token comment"},[t._v("# helm repository URL for helm charts used by Th2 Custom Resources")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("name")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" components\n  "),n("span",{staticClass:"token comment"},[t._v("# the name of the Helm chart without an alias")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("version")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" 3.2.0\n  "),n("span",{staticClass:"token comment"},[t._v("# the targeted Helm chart version")]),t._v("\n"),n("span",{staticClass:"token key atrule"},[t._v("rabbitMQManagement")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("host")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" host\n  "),n("span",{staticClass:"token comment"},[t._v("# RabbitMQ host used for managing vHosts and users")]),t._v("\n  \n  "),n("span",{staticClass:"token key atrule"},[t._v("port")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token number"},[t._v("8080")]),t._v("\n  "),n("span",{staticClass:"token comment"},[t._v("# RabbitMQ port")]),t._v("\n  \n  "),n("span",{staticClass:"token key atrule"},[t._v("username")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" username\n  "),n("span",{staticClass:"token comment"},[t._v("# RabbitMQ management username")]),t._v("\n  \n  "),n("span",{staticClass:"token key atrule"},[t._v("password")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" password\n  "),n("span",{staticClass:"token comment"},[t._v("# password for management user")]),t._v("\n  \n  "),n("span",{staticClass:"token key atrule"},[t._v("persistence")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" "),n("span",{staticClass:"token boolean important"},[t._v("true")]),t._v("\n  "),n("span",{staticClass:"token comment"},[t._v("# determines if the RabbitMQ resources are persistent or not")]),t._v("\n  \n  "),n("span",{staticClass:"token key atrule"},[t._v("schemaPermissions")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n  "),n("span",{staticClass:"token comment"},[t._v("# this section describes what permissions schema RabbitMQ user will have on its own resources")]),t._v("\n  "),n("span",{staticClass:"token comment"},[t._v("# see RabbitMQ documentation to find out how permissions are described")]),t._v("\n    "),n("span",{staticClass:"token key atrule"},[t._v("configure")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" pattern\n    "),n("span",{staticClass:"token comment"},[t._v("# configuration permissions on resources")]),t._v("\n    \n    "),n("span",{staticClass:"token key atrule"},[t._v("read")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" pattern\n    "),n("span",{staticClass:"token comment"},[t._v("# read permission on resources")]),t._v("\n    \n    "),n("span",{staticClass:"token key atrule"},[t._v("write")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" pattern\n    "),n("span",{staticClass:"token comment"},[t._v("# write permission on resources")]),t._v("\n    \n"),n("span",{staticClass:"token key atrule"},[t._v("configMaps")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n"),n("span",{staticClass:"token comment"},[t._v("# this section contains names of the ConfigMaps that are mounted in the boxes")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("rabbitMQ")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" rabbit"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("mq"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("config"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("map\n  "),n("span",{staticClass:"token comment"},[t._v("# RabbitMQ server connectivity ConfigMap")]),t._v("\n"),n("span",{staticClass:"token key atrule"},[t._v("k8sUrl")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" kubernetes"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("address\n"),n("span",{staticClass:"token comment"},[t._v("# address for kubernetes cluster. ")]),t._v("\n"),n("span",{staticClass:"token comment"},[t._v("# this will be used as host in gRPC config for boxes that are running in node network or externally")]),t._v("\n"),n("span",{staticClass:"token key atrule"},[t._v("schemaSecrets")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n"),n("span",{staticClass:"token comment"},[t._v("# this section contains secret names that are mounted in the boxes")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("rabbitMQ")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" rabbitmq\n  "),n("span",{staticClass:"token comment"},[t._v("# secret name to connect to RabbitMQ server")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("cassandra")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" cassandra\n  "),n("span",{staticClass:"token comment"},[t._v("# secret name to connect to cassandra database")]),t._v("\n  \n"),n("span",{staticClass:"token key atrule"},[t._v("ingressHost")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" hostName\n"),n("span",{staticClass:"token comment"},[t._v("# host name that will be used inside ingress rules")]),t._v("\n")])]),n("copy-code-btn")],1),n("spoiler",{attrs:{title:"Example of infra-operator config in service.values.yaml"}},[n("div",{staticClass:"remark-highlight"},[n("pre",{staticClass:"language-yaml"},[n("code",{staticClass:"language-yaml"},[n("span",{staticClass:"token comment"},[t._v("# service.values.yaml")]),t._v("\n"),n("span",{staticClass:"token comment"},[t._v("# ...")]),t._v("\n"),n("span",{staticClass:"token key atrule"},[t._v("infraOperator")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n  "),n("span",{staticClass:"token key atrule"},[t._v("image")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n    "),n("span",{staticClass:"token key atrule"},[t._v("repository")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" ghcr.io/th2"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("net/th2"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("infra"),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v("operator\n    "),n("span",{staticClass:"token key atrule"},[t._v("tag")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" 3.1.3\n  "),n("span",{staticClass:"token key atrule"},[t._v("config")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n    "),n("span",{staticClass:"token key atrule"},[t._v("namespacePrefixes")]),n("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" \n    "),n("span",{staticClass:"token punctuation"},[t._v("-")]),t._v(" "),n("span",{staticClass:"token string"},[t._v('"th2-"')]),t._v("\n")])]),n("copy-code-btn")],1)])],1)}),[],!1,null,null,null);"function"==typeof c&&c(m),"function"==typeof v&&v(m);s.default=m.exports},UQSp:function(t,s,e){"use strict";s.a={name:"VueRemarkRoot",render:function(t){return t("div",null,this.$slots.default)}}}}]);